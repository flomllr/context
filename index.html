<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Electron Hello World!</title>
    <link rel="stylesheet" type="text/css" href="main.css">
  </head>
  <body>
      <div class="menuitems"></div>
      <div class="saveprofile">
        <p>Save current profile</p>
      </div>
      <script>
        const { ipcRenderer } = require('electron');
        const { switchProfile, getCurrentProfile, openProfile } 
        = require('./handler.js');

        const remote = require('electron').remote;
        
        // Save reference to menuItems container
        const container = document.querySelector('.menuitems');

        async function saveWindowsInProfiles() {
          const config = await getCurrentProfile();

          // TODO: Allow name to be set
          const title = 'New Profile ';

          const menuitem = document.createElement('p');
          const text = document.createTextNode(title);
          menuitem.appendChild(text);
          menuitem.addEventListener('click', () => {
            console.log(config);
            openProfile(config);
            const window = remote.getCurrentWindow();
            window.minimize();
          });
          container.appendChild(menuitem);
          
          // update number of available menuitems in the backend
          const numItems = document.querySelectorAll('p').length;
          ipcRenderer.send('numItems', numItems);
        }

        const addButton = document.querySelector('.saveprofile');
        addButton.addEventListener('click', async e => {
          await saveWindowsInProfiles();
          console.log('Profiles', profiles);
        });


        ipcRenderer.on('item:add', (e, item) => {
          console.log(e, item);
          const menuitem = document.createElement('p');
          const text = document.createTextNode(item);
          menuitem.appendChild(text);
          menuitem.addEventListener('click', (e) => {
            console.log("Clicked", item);
            openProfile(item.config);
            const window = remote.getCurrentWindow();
            window.minimize();
          });
          container.appendChild(menuitem);
        });

        ipcRenderer.on('item:updateActive', (e, item) => {
          const items = document.querySelectorAll('p');
          items.forEach((e, index) => {
            if(index === item){
              e.classList.add('selected');
            } else {
              e.classList.remove('selected');
            }
          });
        });

        ipcRenderer.on('item:select', (e, item) => {
          const items = document.querySelectorAll('p');
          items[item].click();
        });
      </script>
  </body>
</html>